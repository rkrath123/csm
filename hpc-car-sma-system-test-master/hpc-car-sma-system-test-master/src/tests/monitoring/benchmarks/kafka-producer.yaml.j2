apiVersion: batch/v1
kind: Job
metadata:
  name: kafka-JOB-TOPIC
  namespace: sma
  labels:
    jobgroup: kafka-producer
spec:
  backoffLimit: 0
  parallelism: 1
# activeDeadlineSeconds: 100
# ttlSecondsAfterFinished: 100
  template:
    metadata:
      name: kafka-producer
      labels:
        jobgroup: kafka-producer
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                  - ncn-w001
      containers:
      - name: kafka-producer
        image: cray_sma/system-test:1.1.0-0.0.1
#       image: bis.local:5000/cray/sma-system-test:latest
        command: [ "/bin/bash", "-c", "--" ]
        args: [ "/tests/monitoring/benchmarks/rdkafka_performance -P -s SIZE -c CNT -a ACKS -t TOPIC -b ${KAFKA_HOSTNAME}:${KAFKA_BROKER_PORT}" ]
#       args: [ "echo hello; sleep 300; exit 0" ]
        env:
        - name: KAFKA_HOSTNAME
          value: "cluster-kafka-bootstrap.sma.svc.cluster.local"
        - name: KAFKA_BROKER_PORT
          value: "9092"
      restartPolicy: Never
      hostname: kafka-producer
